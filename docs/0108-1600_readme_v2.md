# Gmail AI Newsletter Cleaner

A Python tool to automatically identify and delete AI newsletter emails from Gmail with configurable patterns, dry-run support, and detailed logging.

## Features

- ‚úÖ **Pattern-based AI newsletter detection** with configurable keywords and domains
- ‚úÖ **Multiple data formats** - JSON, CSV, or direct Gmail API integration
- ‚úÖ **Dry-run mode** - Preview deletions before executing
- ‚úÖ **Detailed logging** - Complete audit trail of deleted emails
- ‚úÖ **Configurable detection** - Customize patterns via JSON config
- ‚úÖ **Batch processing** - Handle thousands of emails efficiently
- ‚úÖ **Gmail API integration** - Direct inbox operations

## Quick Start

### 1. Installation

```bash
# Install dependencies
pip install -r requirements.txt

# Make scripts executable
chmod +x gmail_ai_newsletter_cleaner.py
chmod +x gmail_api_client.py
chmod +x example_usage.py
```

### 2. Run Example

```bash
# Generate sample data and test the cleaner
python example_usage.py
```

### 3. Use with Your Data

```bash
# Dry run with your email data
python gmail_ai_newsletter_cleaner.py your_emails.json

# Actually delete emails
python gmail_ai_newsletter_cleaner.py your_emails.json --delete
```

## Usage Options

### Option 1: File-based Processing

If you already have email data in JSON/CSV format:

```bash
# Dry run (recommended first)
python gmail_ai_newsletter_cleaner.py emails.json

# With custom config
python gmail_ai_newsletter_cleaner.py emails.json --config custom_config.json

# Actually delete
python gmail_ai_newsletter_cleaner.py emails.json --delete

# CSV format
python gmail_ai_newsletter_cleaner.py emails.csv --format csv
```

### Option 2: Direct Gmail API

For live Gmail operations:

```bash
# Set up Gmail API credentials first (see setup below)

# Dry run - fetch and analyze
python gmail_api_client.py --credentials credentials.json

# Move to trash
python gmail_api_client.py --credentials credentials.json --trash

# Permanent deletion
python gmail_api_client.py --credentials credentials.json --delete

# Save email data for analysis
python gmail_api_client.py --save-data
```

## Gmail API Setup

### 1. Enable Gmail API

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing
3. Enable the Gmail API
4. Go to "Credentials" ‚Üí "Create Credentials" ‚Üí "OAuth 2.0 Client ID"
5. Download the credentials file as `credentials.json`

### 2. Configure OAuth Consent

1. In Google Cloud Console, go to "OAuth consent screen"
2. Add your email as a test user
3. Add scope: `https://www.googleapis.com/auth/gmail.modify`

### 3. First Run Authentication

```bash
python gmail_api_client.py --credentials credentials.json
```

This will open a browser for OAuth authentication and save the token.

## Configuration

### Custom Detection Patterns

Edit `config/config.json` to customize AI newsletter detection:

```json
{
  "ai_keywords": [
    "artificial intelligence",
    "machine learning", 
    "chatgpt",
    "openai"
  ],
  "ai_newsletter_domains": [
    "deeplearning.ai",
    "openai.com",
    "anthropic.com"
  ],
  "confidence_weights": {
    "ai_keywords_subject": 3,
    "known_domain": 4,
    "newsletter_pattern": 2
  },
  "decision_threshold": {
    "minimum_confidence": 4,
    "minimum_reasons": 2
  }
}
```

### Detection Logic

The tool scores emails based on:

- **AI keywords in subject** (weight: 3)
- **AI keywords in sender** (weight: 2) 
- **Known AI domains** (weight: 4)
- **Newsletter patterns** (weight: 2)
- **Unsubscribe links** (weight: 1)
- **Automated senders** (weight: 1)

Default threshold: confidence ‚â• 4 OR (confidence ‚â• 3 AND reasons ‚â• 2)

## Data Formats

### JSON Format

```json
[
  {
    "id": "msg_123",
    "subject": "AI Weekly Newsletter", 
    "sender": "noreply@aiweekly.co",
    "date": "2024-01-15",
    "snippet": "Latest AI updates..."
  }
]
```

### CSV Format

```csv
id,subject,sender,date,snippet
msg_123,"AI Weekly Newsletter","noreply@aiweekly.co","2024-01-15","Latest AI updates..."
```

## Output and Logging

### Log Files

Each run generates a detailed log:
- `gmail_cleanup_YYYYMMDD_HHMMSS.txt` - File-based processing
- `gmail_api_cleanup_YYYYMMDD_HHMMSS.txt` - API-based processing

### Sample Log Entry

```
WOULD DELETE: msg_123
  Subject: AI Weekly Newsletter
  From: noreply@aiweekly.co
  Date: 2024-01-15
  Confidence: 6
  Reasons: Known AI newsletter domain, Newsletter pattern match
--------------------------------------------------------------------------------
```

### Summary Output

```
üìä CLEANUP SUMMARY
==================================================
Total emails analyzed: 16
AI newsletters identified: 8 (50.0%)
Other emails preserved: 8 (50.0%)

‚ö†Ô∏è  DRY RUN MODE - No emails were actually deleted
üîÑ Run with --delete flag to perform actual deletion
üìù Detailed log: gmail_cleanup_20240115_143022.txt
```

## Safety Features

### Dry Run Mode (Default)

- All operations default to dry-run mode
- Must explicitly use `--delete` or `--trash` for actual operations
- Generates identical logs for review before deletion

### Detailed Logging

- Every decision is logged with reasoning
- Email metadata preserved for audit trail
- Confidence scores and pattern matches recorded

### Configurable Thresholds

- Adjust detection sensitivity via `config/config.json`
- Test with sample data before running on real inbox
- Conservative defaults to prevent false positives

## Common Commands

```bash
# Basic dry run
python gmail_ai_newsletter_cleaner.py emails.json

# Review and delete
python gmail_ai_newsletter_cleaner.py emails.json --delete

# Live Gmail processing
python gmail_api_client.py --credentials credentials.json --trash

# Generate test data
python example_usage.py

# Custom configuration
python gmail_ai_newsletter_cleaner.py emails.json --config config/strict_config.json
```

## Troubleshooting

### Gmail API Issues

**Error: Credentials not found**
```bash
# Download credentials.json from Google Cloud Console
# Place in same directory as scripts
```

**Error: Insufficient permissions**
```bash
# Ensure Gmail API is enabled
# Check OAuth consent screen configuration
# Verify scope: https://www.googleapis.com/auth/gmail.modify
```

### Detection Issues

**Too many false positives**
```json
// Increase thresholds in config/config.json
"decision_threshold": {
  "minimum_confidence": 6,
  "minimum_reasons": 3
}
```

**Missing newsletters**
```json
// Add keywords/domains to config/config.json
"ai_keywords": ["your-newsletter-keyword"],
"ai_newsletter_domains": ["newsletter-domain.com"]
```

## File Structure

```
gmail-ai-cleaner/
‚îú‚îÄ‚îÄ gmail_ai_newsletter_cleaner.py    # Main processing script
‚îú‚îÄ‚îÄ gmail_api_client.py               # Gmail API integration  
‚îú‚îÄ‚îÄ example_usage.py                  # Sample data generator
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ config.json                   # AI detection configuration
‚îÇ   ‚îî‚îÄ‚îÄ gmail_fetcher_config.json     # Main fetcher settings
‚îú‚îÄ‚îÄ requirements.txt                  # Python dependencies
‚îî‚îÄ‚îÄ README.md                         # This file
```

## Security Notes

- Credentials are stored locally only
- OAuth tokens have limited scope (Gmail modify only)
- Dry-run mode prevents accidental deletions
- All operations are logged for audit

## Contributing

To add new detection patterns:

1. Update `config/config.json` with new keywords/domains
2. Test with sample data using `example_usage.py`
3. Verify detection accuracy before using on real data

For pattern requests or bug reports, please provide:
- Sample email headers (subject/sender)
- Expected classification result
- Current configuration used
